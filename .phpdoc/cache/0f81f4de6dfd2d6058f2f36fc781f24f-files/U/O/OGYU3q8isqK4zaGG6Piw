1749751334
0f81f4de6dfd2d6058f2f36fc781f24f-phpdoc%3A5de8b9f62402ea88afb20f05e46c4726-c4a03c051256d53332da9d831c71c453
s:29144:"TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlIjoxNDp7czozOToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBuYW1lIjtzOjE4OiJzaW1wbGUtcGhwdW5pdC5waHAiO3M6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAbmFtZXNwYWNlcyI7YTowOnt9czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBpbmNsdWRlcyI7YTowOnt9czo0NDoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBmdW5jdGlvbnMiO2E6MDp7fXM6NDQ6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAY29uc3RhbnRzIjthOjA6e31zOjQyOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGNsYXNzZXMiO2E6MTp7czozMjoiXFN5bWZvbnlFeGNsdWRlTGlzdFNpbXBsZVBocHVuaXQiO086MzU6InBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfIjoxNTp7czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGltcGxlbWVudHMiO2E6MDp7fXM6NDY6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBjb25zdGFudHMiO2E6MDp7fXM6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBwcm9wZXJ0aWVzIjthOjA6e31zOjQ0OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AbWV0aG9kcyI7YTowOnt9czo0NzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAHVzZWRUcmFpdHMiO2E6MDp7fXM6NDU6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBsb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6NDY2O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDg6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBlbmRMb2NhdGlvbiI7TzozMzoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uIjoyOntzOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXExvY2F0aW9uAGxpbmVOdW1iZXIiO2k6NDY4O3M6NDc6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cTG9jYXRpb24AY29sdW1uTnVtYmVyIjtpOjA7fXM6NDI6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBmcXNlbiI7TzozMDoicGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuIjoyOntzOjM3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXEZxc2VuAGZxc2VuIjtzOjMyOiJcU3ltZm9ueUV4Y2x1ZGVMaXN0U2ltcGxlUGhwdW5pdCI7czozNjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxGcXNlbgBuYW1lIjtzOjMxOiJTeW1mb255RXhjbHVkZUxpc3RTaW1wbGVQaHB1bml0Ijt9czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGRvY0Jsb2NrIjtOO3M6NDM6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXENsYXNzXwBwYXJlbnQiO047czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGFic3RyYWN0IjtiOjA7czo0MjoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAGZpbmFsIjtiOjA7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAHJlYWRPbmx5IjtiOjA7czo0NToiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcQ2xhc3NfAG1ldGFkYXRhIjthOjA6e31zOjQ3OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxDbGFzc18AYXR0cmlidXRlcyI7YTowOnt9fX1zOjQ1OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGludGVyZmFjZXMiO2E6MDp7fXM6NDE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAdHJhaXRzIjthOjA6e31zOjQwOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGVudW1zIjthOjA6e31zOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAGhhc2giO3M6MzI6ImM0YTAzYzA1MTI1NmQ1MzMzMmRhOWQ4MzFjNzFjNDUzIjtzOjM5OiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAHBhdGgiO3M6NTI6InZlbmRvci9zeW1mb255L3BocHVuaXQtYnJpZGdlL2Jpbi9zaW1wbGUtcGhwdW5pdC5waHAiO3M6NDE6IgBwaHBEb2N1bWVudG9yXFJlZmxlY3Rpb25cUGhwXEZpbGUAc291cmNlIjtzOjE5NDM5OiI8P3BocAoKLyoKICogVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIFN5bWZvbnkgcGFja2FnZS4KICoKICogKGMpIEZhYmllbiBQb3RlbmNpZXIgPGZhYmllbkBzeW1mb255LmNvbT4KICoKICogRm9yIHRoZSBmdWxsIGNvcHlyaWdodCBhbmQgbGljZW5zZSBpbmZvcm1hdGlvbiwgcGxlYXNlIHZpZXcgdGhlIExJQ0VOU0UKICogZmlsZSB0aGF0IHdhcyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgc291cmNlIGNvZGUuCiAqLwoKLy8gUGxlYXNlIHVwZGF0ZSB3aGVuIHBocHVuaXQgbmVlZHMgdG8gYmUgcmVpbnN0YWxsZWQgd2l0aCBmcmVzaCBkZXBzOgovLyBDYWNoZS1JZDogMjAyMS0wMi0wNCAxMTowMCBVVEMKCmlmICgnY2xpJyAhPT0gXFBIUF9TQVBJICYmICdwaHBkYmcnICE9PSBcUEhQX1NBUEkpIHsKICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ1RoaXMgc2NyaXB0IG11c3QgYmUgcnVuIGZyb20gdGhlIGNvbW1hbmQgbGluZS4nKTsKfQoKZXJyb3JfcmVwb3J0aW5nKC0xKTsKCmdsb2JhbCAkYXJndiwgJGFyZ2M7CiRhcmd2ID0gJF9TRVJWRVJbJ2FyZ3YnXSA/PyBbXTsKJGFyZ2MgPSAkX1NFUlZFUlsnYXJnYyddID8/IDA7CiRnZXRFbnZWYXIgPSBmdW5jdGlvbiAoJG5hbWUsICRkZWZhdWx0ID0gZmFsc2UpIHVzZSAoJGFyZ3YpIHsKICAgIGlmIChmYWxzZSAhPT0gJHZhbHVlID0gZ2V0ZW52KCRuYW1lKSkgewogICAgICAgIHJldHVybiAkdmFsdWU7CiAgICB9CgogICAgc3RhdGljICRwaHB1bml0Q29uZmlnID0gbnVsbDsKICAgIGlmIChudWxsID09PSAkcGhwdW5pdENvbmZpZykgewogICAgICAgICRwaHB1bml0Q29uZmlnRmlsZW5hbWUgPSBudWxsOwogICAgICAgICRnZXRQaHBVbml0Q29uZmlnID0gZnVuY3Rpb24gKCRwcm9iYWJsZUNvbmZpZykgdXNlICgmJGdldFBocFVuaXRDb25maWcpIHsKICAgICAgICAgICAgaWYgKCEkcHJvYmFibGVDb25maWcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc19kaXIoJHByb2JhYmxlQ29uZmlnKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRnZXRQaHBVbml0Q29uZmlnKCRwcm9iYWJsZUNvbmZpZy5cRElSRUNUT1JZX1NFUEFSQVRPUi4ncGhwdW5pdC54bWwnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKCRwcm9iYWJsZUNvbmZpZykpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkcHJvYmFibGVDb25maWc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpbGVfZXhpc3RzKCRwcm9iYWJsZUNvbmZpZy4nLmRpc3QnKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICRwcm9iYWJsZUNvbmZpZy4nLmRpc3QnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9OwoKICAgICAgICBmb3JlYWNoICgkYXJndiBhcyAkY2xpQXJndW1lbnRJbmRleCA9PiAkY2xpQXJndW1lbnQpIHsKICAgICAgICAgICAgaWYgKCctLScgPT09ICRjbGlBcmd1bWVudCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbG9uZyBvcHRpb24KICAgICAgICAgICAgaWYgKCctLWNvbmZpZ3VyYXRpb24nID09PSAkY2xpQXJndW1lbnQgJiYgYXJyYXlfa2V5X2V4aXN0cygkY2xpQXJndW1lbnRJbmRleCArIDEsICRhcmd2KSkgewogICAgICAgICAgICAgICAgJHBocHVuaXRDb25maWdGaWxlbmFtZSA9ICRnZXRQaHBVbml0Q29uZmlnKCRhcmd2WyRjbGlBcmd1bWVudEluZGV4ICsgMV0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gc2hvcnQgb3B0aW9uCiAgICAgICAgICAgIGlmICgwID09PSBzdHJwb3MoJGNsaUFyZ3VtZW50LCAnLWMnKSkgewogICAgICAgICAgICAgICAgaWYgKCctYycgPT09ICRjbGlBcmd1bWVudCAmJiBhcnJheV9rZXlfZXhpc3RzKCRjbGlBcmd1bWVudEluZGV4ICsgMSwgJGFyZ3YpKSB7CiAgICAgICAgICAgICAgICAgICAgJHBocHVuaXRDb25maWdGaWxlbmFtZSA9ICRnZXRQaHBVbml0Q29uZmlnKCRhcmd2WyRjbGlBcmd1bWVudEluZGV4ICsgMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkcGhwdW5pdENvbmZpZ0ZpbGVuYW1lID0gJGdldFBocFVuaXRDb25maWcoc3Vic3RyKCRjbGlBcmd1bWVudCwgMikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRwaHB1bml0Q29uZmlnRmlsZW5hbWUgPSAkcGhwdW5pdENvbmZpZ0ZpbGVuYW1lID86ICRnZXRQaHBVbml0Q29uZmlnKCdwaHB1bml0LnhtbCcpOwoKICAgICAgICBpZiAoJHBocHVuaXRDb25maWdGaWxlbmFtZSkgewogICAgICAgICAgICAkcGhwdW5pdENvbmZpZyA9IG5ldyBET01Eb2N1bWVudCgpOwogICAgICAgICAgICAkcGhwdW5pdENvbmZpZy0+bG9hZCgkcGhwdW5pdENvbmZpZ0ZpbGVuYW1lKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkcGhwdW5pdENvbmZpZyA9IGZhbHNlOwogICAgICAgIH0KICAgIH0KICAgIGlmIChmYWxzZSAhPT0gJHBocHVuaXRDb25maWcpIHsKICAgICAgICAkdmFyID0gbmV3IERPTVhQYXRoKCRwaHB1bml0Q29uZmlnKTsKICAgICAgICBmb3JlYWNoICgkdmFyLT5xdWVyeSgnLy9waHAvc2VydmVyW0BuYW1lPSInLiRuYW1lLiciXScpIGFzICR2YXIpIHsKICAgICAgICAgICAgcmV0dXJuICR2YXItPmdldEF0dHJpYnV0ZSgndmFsdWUnKTsKICAgICAgICB9CiAgICAgICAgZm9yZWFjaCAoJHZhci0+cXVlcnkoJy8vcGhwL2VudltAbmFtZT0iJy4kbmFtZS4nIl0nKSBhcyAkdmFyKSB7CiAgICAgICAgICAgIHJldHVybiAkdmFyLT5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJyk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkZGVmYXVsdDsKfTsKCiRwYXNzdGhydU9yRmFpbCA9IGZ1bmN0aW9uICgkY29tbWFuZCkgewogICAgcGFzc3RocnUoJGNvbW1hbmQsICRzdGF0dXMpOwoKICAgIGlmICgkc3RhdHVzKSB7CiAgICAgICAgZXhpdCgkc3RhdHVzKTsKICAgIH0KfTsKCmlmIChcUEhQX1ZFUlNJT05fSUQgPj0gODAwMDApIHsKICAgICRQSFBVTklUX1ZFUlNJT04gPSAkZ2V0RW52VmFyKCdTWU1GT05ZX1BIUFVOSVRfVkVSU0lPTicsICc5LjYnKSA/OiAnOS42JzsKfSBlbHNlIHsKICAgICRQSFBVTklUX1ZFUlNJT04gPSAkZ2V0RW52VmFyKCdTWU1GT05ZX1BIUFVOSVRfVkVSU0lPTicsICc4LjUnKSA/OiAnOC41JzsKfQoKJE1BWF9QSFBVTklUX1ZFUlNJT04gPSAkZ2V0RW52VmFyKCdTWU1GT05ZX01BWF9QSFBVTklUX1ZFUlNJT04nLCBmYWxzZSk7CgppZiAoJE1BWF9QSFBVTklUX1ZFUlNJT04gJiYgdmVyc2lvbl9jb21wYXJlKCRNQVhfUEhQVU5JVF9WRVJTSU9OLCAkUEhQVU5JVF9WRVJTSU9OLCAnPCcpKSB7CiAgICAkUEhQVU5JVF9WRVJTSU9OID0gJE1BWF9QSFBVTklUX1ZFUlNJT047Cn0KCmlmICh2ZXJzaW9uX2NvbXBhcmUoJFBIUFVOSVRfVkVSU0lPTiwgJzEwLjAnLCAnPj0nKSAmJiB2ZXJzaW9uX2NvbXBhcmUoJFBIUFVOSVRfVkVSU0lPTiwgJzExLjAnLCAnPCcpKSB7CiAgICBmd3JpdGUoU1RERVJSLCAnVGhpcyBzY3JpcHQgZG9lcyBub3Qgd29yayB3aXRoIFBIUFVuaXQgMTAuJy5cUEhQX0VPTCk7CiAgICBleGl0KDEpOwp9CgokUEhQVU5JVF9SRU1PVkVfUkVUVVJOX1RZUEVISU5UID0gZmlsdGVyX3ZhcigkZ2V0RW52VmFyKCdTWU1GT05ZX1BIUFVOSVRfUkVNT1ZFX1JFVFVSTl9UWVBFSElOVCcsICcwJyksIFxGSUxURVJfVkFMSURBVEVfQk9PTEVBTik7CgokQ09NUE9TRVJfSlNPTiA9IGdldGVudignQ09NUE9TRVInKSA/OiAnY29tcG9zZXIuanNvbic7Cgokcm9vdCA9IF9fRElSX187CndoaWxlICghZmlsZV9leGlzdHMoJHJvb3QuJy8nLiRDT01QT1NFUl9KU09OKSB8fCBmaWxlX2V4aXN0cygkcm9vdC4nL0RlcHJlY2F0aW9uRXJyb3JIYW5kbGVyLnBocCcpKSB7CiAgICBpZiAoJHJvb3QgPT09IGRpcm5hbWUoJHJvb3QpKSB7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICAkcm9vdCA9IGRpcm5hbWUoJHJvb3QpOwp9Cgokb2xkUHdkID0gZ2V0Y3dkKCk7CiRQSFBVTklUX0RJUiA9IHJ0cmltKCRnZXRFbnZWYXIoJ1NZTUZPTllfUEhQVU5JVF9ESVInLCAkcm9vdC4nL3ZlbmRvci9iaW4vLnBocHVuaXQnKSwgJy8nLlxESVJFQ1RPUllfU0VQQVJBVE9SKTsKJFBIUCA9IGRlZmluZWQoJ1BIUF9CSU5BUlknKSA/IFxQSFBfQklOQVJZIDogJ3BocCc7CiRQSFAgPSBlc2NhcGVzaGVsbGFyZygkUEhQKTsKaWYgKCdwaHBkYmcnID09PSBcUEhQX1NBUEkpIHsKICAgICRQSFAgLj0gJyAtcXJyJzsKfQoKJGRlZmF1bHRFbnZzID0gWwogICAgJ0NPTVBPU0VSJyA9PiAnY29tcG9zZXIuanNvbicsCiAgICAnQ09NUE9TRVJfVkVORE9SX0RJUicgPT4gJ3ZlbmRvcicsCiAgICAnQ09NUE9TRVJfQklOX0RJUicgPT4gJ2JpbicsCiAgICAnU1lNRk9OWV9TSU1QTEVfUEhQVU5JVF9CSU5fRElSJyA9PiBfX0RJUl9fLApdOwoKZm9yZWFjaCAoJGRlZmF1bHRFbnZzIGFzICRlbnZOYW1lID0+ICRlbnZWYWx1ZSkgewogICAgaWYgKCRlbnZWYWx1ZSAhPT0gZ2V0ZW52KCRlbnZOYW1lKSkgewogICAgICAgIHB1dGVudigiJGVudk5hbWU9JGVudlZhbHVlIik7CiAgICAgICAgJF9TRVJWRVJbJGVudk5hbWVdID0gJF9FTlZbJGVudk5hbWVdID0gJGVudlZhbHVlOwogICAgfQp9CgppZiAoJ2Rpc2FibGVkJyA9PT0gJGdldEVudlZhcignU1lNRk9OWV9ERVBSRUNBVElPTlNfSEVMUEVSJykgfHwgdmVyc2lvbl9jb21wYXJlKCRQSFBVTklUX1ZFUlNJT04sICcxMS4wJywgJz49JykpIHsKICAgIHB1dGVudignU1lNRk9OWV9ERVBSRUNBVElPTlNfSEVMUEVSPWRpc2FibGVkJyk7Cn0KCmlmICghJGdldEVudlZhcignRE9DVFJJTkVfREVQUkVDQVRJT05TJykpIHsKICAgIHB1dGVudignRE9DVFJJTkVfREVQUkVDQVRJT05TPXRyaWdnZXInKTsKICAgICRfU0VSVkVSWydET0NUUklORV9ERVBSRUNBVElPTlMnXSA9ICRfRU5WWydET0NUUklORV9ERVBSRUNBVElPTlMnXSA9ICd0cmlnZ2VyJzsKfQoKJENPTVBPU0VSID0gKCRDT01QT1NFUiA9IGdldGVudignQ09NUE9TRVJfQklOQVJZJykpCiAgICB8fCBmaWxlX2V4aXN0cygkQ09NUE9TRVIgPSAkb2xkUHdkLicvY29tcG9zZXIucGhhcicpCiAgICB8fCAoJENPTVBPU0VSID0gcnRyaW0oKHN0cmluZykgKCdcXCcgPT09IFxESVJFQ1RPUllfU0VQQVJBVE9SID8gcHJlZ19yZXBsYWNlKCcvW1xyXG5dLiovJywgJycsIHNoZWxsX2V4ZWMoJ3doZXJlLmV4ZSBjb21wb3Nlci5waGFyIDI+IE5VTCcpKSA6IHNoZWxsX2V4ZWMoJ3doaWNoIGNvbXBvc2VyLnBoYXIgMj4gL2Rldi9udWxsJykpKSkKICAgIHx8ICgkQ09NUE9TRVIgPSBydHJpbSgoc3RyaW5nKSAoJ1xcJyA9PT0gXERJUkVDVE9SWV9TRVBBUkFUT1IgPyBwcmVnX3JlcGxhY2UoJy9bXHJcbl0uKi8nLCAnJywgc2hlbGxfZXhlYygnd2hlcmUuZXhlIGNvbXBvc2VyIDI+IE5VTCcpKSA6IHNoZWxsX2V4ZWMoJ3doaWNoIGNvbXBvc2VyIDI+IC9kZXYvbnVsbCcpKSkpCiAgICB8fCBmaWxlX2V4aXN0cygkQ09NUE9TRVIgPSBydHJpbSgoc3RyaW5nKSAoJ1xcJyA9PT0gXERJUkVDVE9SWV9TRVBBUkFUT1IgPyBzaGVsbF9leGVjKCdnaXQgcmV2LXBhcnNlIC0tc2hvdy10b3BsZXZlbCAyPiBOVUwnKSA6IHNoZWxsX2V4ZWMoJ2dpdCByZXYtcGFyc2UgLS1zaG93LXRvcGxldmVsIDI+IC9kZXYvbnVsbCcpKSkuXERJUkVDVE9SWV9TRVBBUkFUT1IuJ2NvbXBvc2VyLnBoYXInKQogICAgPyAoJyMhL3Vzci9iaW4vZW52IHBocCcgPT09IGZpbGVfZ2V0X2NvbnRlbnRzKCRDT01QT1NFUiwgZmFsc2UsIG51bGwsIDAsIDE4KSA/ICRQSFAgOiAnJykuJyAnLmVzY2FwZXNoZWxsYXJnKCRDT01QT1NFUikgLy8gZGV0ZWN0IHNoZWxsIHdyYXBwZXJzIGJ5IGxvb2tpbmcgYXQgdGhlIHNoZWJhbmcKICAgIDogJ2NvbXBvc2VyJzsKCiRwcmV2Q2FjaGVEaXIgPSBnZXRlbnYoJ0NPTVBPU0VSX0NBQ0hFX0RJUicpOwppZiAoJHByZXZDYWNoZURpcikgewogICAgaWYgKGZhbHNlID09PSAkYWJzb2x1dGVDYWNoZURpciA9IHJlYWxwYXRoKCRwcmV2Q2FjaGVEaXIpKSB7CiAgICAgICAgQG1rZGlyKCRwcmV2Q2FjaGVEaXIsIDA3NzcsIHRydWUpOwogICAgICAgICRhYnNvbHV0ZUNhY2hlRGlyID0gcmVhbHBhdGgoJHByZXZDYWNoZURpcik7CiAgICB9CiAgICBpZiAoJGFic29sdXRlQ2FjaGVEaXIpIHsKICAgICAgICBwdXRlbnYoIkNPTVBPU0VSX0NBQ0hFX0RJUj0kYWJzb2x1dGVDYWNoZURpciIpOwogICAgfSBlbHNlIHsKICAgICAgICAkcHJldkNhY2hlRGlyID0gZmFsc2U7CiAgICB9Cn0KJFNZTUZPTllfUEhQVU5JVF9SRU1PVkUgPSAkZ2V0RW52VmFyKCdTWU1GT05ZX1BIUFVOSVRfUkVNT1ZFJywgJ3BocHNwZWMvcHJvcGhlY3knLigkUEhQVU5JVF9WRVJTSU9OIDwgNi4wID8gJyBzeW1mb255L3lhbWwnIDogJycpKTsKJFNZTUZPTllfUEhQVU5JVF9SRVFVSVJFID0gJGdldEVudlZhcignU1lNRk9OWV9QSFBVTklUX1JFUVVJUkUnLCAnJyk7CiRjb25maWd1cmF0aW9uSGFzaCA9IG1kNShpbXBsb2RlKFxQSFBfRU9MLCBbbWQ1X2ZpbGUoX19GSUxFX18pLCAkU1lNRk9OWV9QSFBVTklUX1JFTU9WRSwgJFNZTUZPTllfUEhQVU5JVF9SRVFVSVJFLCAoaW50KSAkUEhQVU5JVF9SRU1PVkVfUkVUVVJOX1RZUEVISU5UXSkpOwokUEhQVU5JVF9WRVJTSU9OX0RJUiA9IHNwcmludGYoJ3BocHVuaXQtJXMtJWQnLCAkUEhQVU5JVF9WRVJTSU9OLCAkUEhQVU5JVF9SRU1PVkVfUkVUVVJOX1RZUEVISU5UKTsKaWYgKCFmaWxlX2V4aXN0cygiJFBIUFVOSVRfRElSLyRQSFBVTklUX1ZFUlNJT05fRElSL3BocHVuaXQiKSB8fCAkY29uZmlndXJhdGlvbkhhc2ggIT09IEBmaWxlX2dldF9jb250ZW50cygiJFBIUFVOSVRfRElSLy4kUEhQVU5JVF9WRVJTSU9OX0RJUi5tZDUiKSkgewogICAgLy8gQnVpbGQgYSBzdGFuZGFsb25lIHBocHVuaXQgd2l0aG91dCBzeW1mb255L3lhbWwgbm9yIHByb3BoZWN5IGJ5IGRlZmF1bHQKCiAgICBAbWtkaXIoJFBIUFVOSVRfRElSLCAwNzc3LCB0cnVlKTsKICAgIGNoZGlyKCRQSFBVTklUX0RJUik7CiAgICBpZiAoZmlsZV9leGlzdHMoIiRQSFBVTklUX1ZFUlNJT05fRElSIikpIHsKICAgICAgICBwYXNzdGhydShzcHJpbnRmKCdcXCcgPT09IFxESVJFQ1RPUllfU0VQQVJBVE9SID8gJ3JtZGlyIC9TIC9RICVzIDI+IE5VTCcgOiAncm0gLXJmICVzJywgZXNjYXBlc2hlbGxhcmcoIiRQSFBVTklUX1ZFUlNJT05fRElSLm9sZCIpKSk7CiAgICAgICAgcmVuYW1lKCIkUEhQVU5JVF9WRVJTSU9OX0RJUiIsICIkUEhQVU5JVF9WRVJTSU9OX0RJUi5vbGQiKTsKICAgICAgICBwYXNzdGhydShzcHJpbnRmKCdcXCcgPT09IFxESVJFQ1RPUllfU0VQQVJBVE9SID8gJ3JtZGlyIC9TIC9RICVzJyA6ICdybSAtcmYgJXMnLCBlc2NhcGVzaGVsbGFyZygiJFBIUFVOSVRfVkVSU0lPTl9ESVIub2xkIikpKTsKICAgIH0KCiAgICAkaW5mbyA9IFtdOwogICAgZm9yZWFjaCAoZXhwbG9kZSgiXG4iLCBgJENPTVBPU0VSIGluZm8gLS1uby1hbnNpIC1hIC1uIHBocHVuaXQvcGhwdW5pdCAiJFBIUFVOSVRfVkVSU0lPTi4qImApIGFzICRsaW5lKSB7CiAgICAgICAgJGxpbmUgPSBydHJpbSgkbGluZSk7CgogICAgICAgIGlmICghJGluZm8gJiYgcHJlZ19tYXRjaCgnL152ZXJzaW9ucyArOiAvJywgJGxpbmUpKSB7CiAgICAgICAgICAgICRpbmZvWyd2ZXJzaW9ucyddID0gZXhwbG9kZSgnLCAnLCBsdHJpbShzdWJzdHIoJGxpbmUsIDkpLCAnOiAnKSk7CiAgICAgICAgfSBlbHNlaWYgKGlzc2V0KCRpbmZvWydyZXF1aXJlcyddKSkgewogICAgICAgICAgICBpZiAoJycgPT09ICRsaW5lKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJGxpbmUgPSBleHBsb2RlKCcgJywgJGxpbmUsIDIpOwogICAgICAgICAgICAkaW5mb1sncmVxdWlyZXMnXVskbGluZVswXV0gPSAkbGluZVsxXTsKICAgICAgICB9IGVsc2VpZiAoJGluZm8gJiYgJ3JlcXVpcmVzJyA9PT0gJGxpbmUpIHsKICAgICAgICAgICAgJGluZm9bJ3JlcXVpcmVzJ10gPSBbXTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKGluX2FycmF5KCctLWNvbG9ycz1uZXZlcicsICRhcmd2LCB0cnVlKSB8fCAoaXNzZXQoJGFyZ3ZbJGkgPSBhcnJheV9zZWFyY2goJ25ldmVyJywgJGFyZ3YsIHRydWUpIC0gMV0pICYmICctLWNvbG9ycycgPT09ICRhcmd2WyRpXSkpIHsKICAgICAgICAkQ09NUE9TRVIgLj0gJyAtLW5vLWFuc2knOwogICAgfSBlbHNlIHsKICAgICAgICAkQ09NUE9TRVIgLj0gJyAtLWFuc2knOwogICAgfQoKICAgICRpbmZvICs9IFsKICAgICAgICAndmVyc2lvbnMnID0+IFtdLAogICAgICAgICdyZXF1aXJlcycgPT4gWydwaHAnID0+ICcqJ10sCiAgICBdOwoKICAgICRzdGFibGVWZXJzaW9ucyA9IGFycmF5X2ZpbHRlcigkaW5mb1sndmVyc2lvbnMnXSwgZnVuY3Rpb24gKCR2KSB7CiAgICAgICAgcmV0dXJuICFwcmVnX21hdGNoKCcvLWRldiR8XmRldi0vJywgJHYpOwogICAgfSk7CgogICAgaWYgKCEkc3RhYmxlVmVyc2lvbnMpIHsKICAgICAgICAkcGFzc3RocnVPckZhaWwoIiRDT01QT1NFUiBjcmVhdGUtcHJvamVjdCAtLWlnbm9yZS1wbGF0Zm9ybS1yZXFzIC0tbm8taW5zdGFsbCAtLXByZWZlci1kaXN0IC0tbm8tc2NyaXB0cyAtLW5vLXBsdWdpbnMgLS1uby1wcm9ncmVzcyAtcyBkZXYgcGhwdW5pdC9waHB1bml0ICRQSFBVTklUX1ZFUlNJT05fRElSIFwiJFBIUFVOSVRfVkVSU0lPTi4qXCIiKTsKICAgIH0gZWxzZSB7CiAgICAgICAgJHBhc3N0aHJ1T3JGYWlsKCIkQ09NUE9TRVIgY3JlYXRlLXByb2plY3QgLS1pZ25vcmUtcGxhdGZvcm0tcmVxcyAtLW5vLWluc3RhbGwgLS1wcmVmZXItZGlzdCAtLW5vLXNjcmlwdHMgLS1uby1wbHVnaW5zIC0tbm8tcHJvZ3Jlc3MgcGhwdW5pdC9waHB1bml0ICRQSFBVTklUX1ZFUlNJT05fRElSIFwiJFBIUFVOSVRfVkVSU0lPTi4qXCIiKTsKICAgIH0KCiAgICBAY29weSgiJFBIUFVOSVRfVkVSU0lPTl9ESVIvcGhwdW5pdC54c2QiLCAncGhwdW5pdC54c2QnKTsKICAgIGNoZGlyKCIkUEhQVU5JVF9WRVJTSU9OX0RJUiIpOwogICAgaWYgKCRTWU1GT05ZX1BIUFVOSVRfUkVNT1ZFKSB7CiAgICAgICAgJHBhc3N0aHJ1T3JGYWlsKCIkQ09NUE9TRVIgcmVtb3ZlIC0tbm8tdXBkYXRlIC0tbm8taW50ZXJhY3Rpb24gIi4kU1lNRk9OWV9QSFBVTklUX1JFTU9WRSk7CiAgICB9CiAgICBpZiAoJFNZTUZPTllfUEhQVU5JVF9SRVFVSVJFKSB7CiAgICAgICAgJHBhc3N0aHJ1T3JGYWlsKCIkQ09NUE9TRVIgcmVxdWlyZSAtLW5vLXVwZGF0ZSAtLW5vLWludGVyYWN0aW9uICIuJFNZTUZPTllfUEhQVU5JVF9SRVFVSVJFKTsKICAgIH0KICAgIGlmICg1LjEgPD0gJFBIUFVOSVRfVkVSU0lPTiAmJiAkUEhQVU5JVF9WRVJTSU9OIDwgNS40KSB7CiAgICAgICAgJHBhc3N0aHJ1T3JGYWlsKCIkQ09NUE9TRVIgcmVxdWlyZSAtLW5vLXVwZGF0ZSBwaHB1bml0L3BocHVuaXQtbW9jay1vYmplY3RzIFwifjMuMS4wXCIiKTsKICAgIH0KCiAgICBpZiAocHJlZ19tYXRjaCgne1xeKChcZCsrXC4pXGQrKylbXGRcLl0qJH0nLCAkaW5mb1sncmVxdWlyZXMnXVsncGhwJ10sICRwaHBWZXJzaW9uKSAmJiB2ZXJzaW9uX2NvbXBhcmUoJHBocFZlcnNpb25bMl0uJzk5JywgXFBIUF9WRVJTSU9OLCAnPCcpKSB7CiAgICAgICAgJHBhc3N0aHJ1T3JGYWlsKCIkQ09NUE9TRVIgY29uZmlnIHBsYXRmb3JtLnBocCBcIiRwaHBWZXJzaW9uWzFdLjk5XCIiKTsKICAgIH0gZWxzZSB7CiAgICAgICAgJHBhc3N0aHJ1T3JGYWlsKCIkQ09NUE9TRVIgY29uZmlnIC0tdW5zZXQgcGxhdGZvcm0ucGhwIik7CiAgICB9CiAgICBpZiAoZmlsZV9leGlzdHMoJHBhdGggPSAkcm9vdC4nL3ZlbmRvci9zeW1mb255L3BocHVuaXQtYnJpZGdlJykpIHsKICAgICAgICAkaGF5c3RhY2sgPSAiJFBIUFVOSVRfRElSLyRQSFBVTklUX1ZFUlNJT05fRElSIjsKICAgICAgICAkcm9vdExlbiA9IHN0cmxlbigkcm9vdCk7CgogICAgICAgICRwID0gKCRyb290TGVuIDw9IHN0cmxlbigkaGF5c3RhY2spID8gc3RyX3JlcGVhdCgnLi4vJywgc3Vic3RyX2NvdW50KCRoYXlzdGFjaywgJy8nLCAkcm9vdExlbikpIDogJycpLid2ZW5kb3Ivc3ltZm9ueS9waHB1bml0LWJyaWRnZSc7CiAgICAgICAgaWYgKHJlYWxwYXRoKCRwKSA9PT0gcmVhbHBhdGgoJHBhdGgpKSB7CiAgICAgICAgICAgICRwYXRoID0gJHA7CiAgICAgICAgfQogICAgICAgICRwYXNzdGhydU9yRmFpbCgiJENPTVBPU0VSIHJlcXVpcmUgLS1uby11cGRhdGUgc3ltZm9ueS9waHB1bml0LWJyaWRnZSBcIipAZGV2XCIiKTsKICAgICAgICAkcGFzc3RocnVPckZhaWwoIiRDT01QT1NFUiBjb25maWcgcmVwb3NpdG9yaWVzLnBocHVuaXQtYnJpZGdlIHBhdGggIi5lc2NhcGVzaGVsbGFyZyhzdHJfcmVwbGFjZSgnLycsIFxESVJFQ1RPUllfU0VQQVJBVE9SLCAkcGF0aCkpKTsKICAgICAgICBpZiAoJ1xcJyA9PT0gXERJUkVDVE9SWV9TRVBBUkFUT1IpIHsKICAgICAgICAgICAgZmlsZV9wdXRfY29udGVudHMoJ2NvbXBvc2VyLmpzb24nLCBwcmVnX3JlcGxhY2UoJy9eKCB7OH0pInBocHVuaXQtYnJpZGdlIjogXHskL20nLCAiJDBcbiQxICAgICIuJyJvcHRpb25zIjogeyJzeW1saW5rIjogZmFsc2V9LCcsIGZpbGVfZ2V0X2NvbnRlbnRzKCdjb21wb3Nlci5qc29uJykpKTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgICRwYXNzdGhydU9yRmFpbCgiJENPTVBPU0VSIHJlcXVpcmUgLS1uby11cGRhdGUgc3ltZm9ueS9waHB1bml0LWJyaWRnZSBcIipcIiIpOwogICAgfQogICAgJHByZXZSb290ID0gZ2V0ZW52KCdDT01QT1NFUl9ST09UX1ZFUlNJT04nKTsKICAgIHB1dGVudigiQ09NUE9TRVJfUk9PVF9WRVJTSU9OPSRQSFBVTklUX1ZFUlNJT04uOTkiKTsKICAgICRxID0gJ1xcJyA9PT0gXERJUkVDVE9SWV9TRVBBUkFUT1IgJiYgXFBIUF9WRVJTSU9OX0lEIDwgODAwMDAgPyAnIicgOiAnJzsKICAgIC8vIC0tbm8tc3VnZ2VzdCBpcyBub3QgaW4gdGhlIGxpc3QgdG8ga2VlcCBjb21wYXQgd2l0aCBjb21wb3NlciAxLjAsIHdoaWNoIGlzIHNoaXBwZWQgd2l0aCBVYnVudHUgMTYuMDRMVFMKICAgICRleGl0ID0gcHJvY19jbG9zZShwcm9jX29wZW4oIiRxJENPTVBPU0VSIHVwZGF0ZSAtLW5vLWRldiAtLXByZWZlci1kaXN0IC0tbm8tcHJvZ3Jlc3MgJHEiLCBbXSwgJHAsIGdldGN3ZCgpKSk7CiAgICBwdXRlbnYoJ0NPTVBPU0VSX1JPT1RfVkVSU0lPTicuKGZhbHNlICE9PSAkcHJldlJvb3QgPyAnPScuJHByZXZSb290IDogJycpKTsKICAgIGlmICgkcHJldkNhY2hlRGlyKSB7CiAgICAgICAgcHV0ZW52KCJDT01QT1NFUl9DQUNIRV9ESVI9JHByZXZDYWNoZURpciIpOwogICAgfQogICAgaWYgKCRleGl0KSB7CiAgICAgICAgZXhpdCgkZXhpdCk7CiAgICB9CgogICAgLy8gTXV0YXRlIFRlc3RDYXNlIGNvZGUKICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoJFBIUFVOSVRfVkVSU0lPTiwgJzExLjAnLCAnPCcpKSB7CiAgICAgICAgJGFsdGVyZWRDb2RlID0gZmlsZV9nZXRfY29udGVudHMoJGFsdGVyZWRGaWxlID0gJy4vc3JjL0ZyYW1ld29yay9UZXN0Q2FzZS5waHAnKTsKICAgICAgICBpZiAoJFBIUFVOSVRfUkVNT1ZFX1JFVFVSTl9UWVBFSElOVCkgewogICAgICAgICAgICAkYWx0ZXJlZENvZGUgPSBwcmVnX3JlcGxhY2UoJy9eICAgICgoPzpwcm90ZWN0ZWR8cHVibGljKSg/OiBzdGF0aWMpPyBmdW5jdGlvbiBcdytcKFwpKTogdm9pZC9tJywgJyAgICAkMScsICRhbHRlcmVkQ29kZSk7CiAgICAgICAgfQogICAgICAgICRhbHRlcmVkQ29kZSA9IHByZWdfcmVwbGFjZSgnL2Fic3RyYWN0IGNsYXNzIFRlc3RDYXNlW15ce10rXHsvJywgJyQwICcuXFBIUF9FT0wuIiAgICB1c2UgXFN5bWZvbnlcQnJpZGdlXFBocFVuaXRcTGVnYWN5XFBvbHlmaWxsVGVzdENhc2VUcmFpdDsiLCAkYWx0ZXJlZENvZGUsIDEpOwogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCRhbHRlcmVkRmlsZSwgJGFsdGVyZWRDb2RlKTsKCiAgICAgICAgLy8gTXV0YXRlIEFzc2VydCBjb2RlCiAgICAgICAgJGFsdGVyZWRDb2RlID0gZmlsZV9nZXRfY29udGVudHMoJGFsdGVyZWRGaWxlID0gJy4vc3JjL0ZyYW1ld29yay9Bc3NlcnQucGhwJyk7CiAgICAgICAgJGFsdGVyZWRDb2RlID0gcHJlZ19yZXBsYWNlKCcvYWJzdHJhY3QgY2xhc3MgQXNzZXJ0W15ce10rXHsvJywgJyQwICcuXFBIUF9FT0wuIiAgICB1c2UgXFN5bWZvbnlcQnJpZGdlXFBocFVuaXRcTGVnYWN5XFBvbHlmaWxsQXNzZXJ0VHJhaXQ7IiwgJGFsdGVyZWRDb2RlLCAxKTsKICAgICAgICBmaWxlX3B1dF9jb250ZW50cygkYWx0ZXJlZEZpbGUsICRhbHRlcmVkQ29kZSk7CgogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCdwaHB1bml0JywgPDw8J0VPUEhQJwo8P3BocAoKZGVmaW5lKCdQSFBVTklUX0NPTVBPU0VSX0lOU1RBTEwnLCBfX0RJUl9fLicvdmVuZG9yL2F1dG9sb2FkLnBocCcpOwpyZXF1aXJlIFBIUFVOSVRfQ09NUE9TRVJfSU5TVEFMTDsKCmlmICghY2xhc3NfZXhpc3RzKFxTeW1mb255RXhjbHVkZUxpc3RQaHB1bml0OjpjbGFzcywgZmFsc2UpKSB7CiAgICBjbGFzcyBTeW1mb255RXhjbHVkZUxpc3RQaHB1bml0IHt9Cn0KaWYgKG1ldGhvZF9leGlzdHMoXFBIUFVuaXRcVXRpbFxFeGNsdWRlTGlzdDo6Y2xhc3MsICdhZGREaXJlY3RvcnknKSkgewogICAgKG5ldyBQSFBVbml0XFV0aWxcRXhjbHVkZWxpc3QoKSktPmdldEV4Y2x1ZGVkRGlyZWN0b3JpZXMoKTsKICAgIFBIUFVuaXRcVXRpbFxFeGNsdWRlTGlzdDo6YWRkRGlyZWN0b3J5KFxkaXJuYW1lKChuZXcgXFJlZmxlY3Rpb25DbGFzcyhcU3ltZm9ueUV4Y2x1ZGVMaXN0UGhwdW5pdDo6Y2xhc3MpKS0+Z2V0RmlsZU5hbWUoKSkpOwogICAgY2xhc3NfZXhpc3RzKFxTeW1mb255RXhjbHVkZUxpc3RTaW1wbGVQaHB1bml0OjpjbGFzcywgZmFsc2UpICYmIFBIUFVuaXRcVXRpbFxFeGNsdWRlTGlzdDo6YWRkRGlyZWN0b3J5KFxkaXJuYW1lKChuZXcgXFJlZmxlY3Rpb25DbGFzcyhcU3ltZm9ueUV4Y2x1ZGVMaXN0U2ltcGxlUGhwdW5pdDo6Y2xhc3MpKS0+Z2V0RmlsZU5hbWUoKSkpOwp9IGVsc2VpZiAobWV0aG9kX2V4aXN0cyhcUEhQVW5pdFxVdGlsXEJsYWNrbGlzdDo6Y2xhc3MsICdhZGREaXJlY3RvcnknKSkgewogICAgKG5ldyBQSFBVbml0XFV0aWxcQmxhY2tMaXN0KCkpLT5nZXRCbGFja2xpc3RlZERpcmVjdG9yaWVzKCk7CiAgICBQSFBVbml0XFV0aWxcQmxhY2tsaXN0OjphZGREaXJlY3RvcnkoXGRpcm5hbWUoKG5ldyBcUmVmbGVjdGlvbkNsYXNzKFxTeW1mb255RXhjbHVkZUxpc3RQaHB1bml0OjpjbGFzcykpLT5nZXRGaWxlTmFtZSgpKSk7CiAgICBjbGFzc19leGlzdHMoXFN5bWZvbnlFeGNsdWRlTGlzdFNpbXBsZVBocHVuaXQ6OmNsYXNzLCBmYWxzZSkgJiYgUEhQVW5pdFxVdGlsXEJsYWNrbGlzdDo6YWRkRGlyZWN0b3J5KFxkaXJuYW1lKChuZXcgXFJlZmxlY3Rpb25DbGFzcyhcU3ltZm9ueUV4Y2x1ZGVMaXN0U2ltcGxlUGhwdW5pdDo6Y2xhc3MpKS0+Z2V0RmlsZU5hbWUoKSkpOwp9IGVsc2UgewogICAgUEhQVW5pdFxVdGlsXEJsYWNrbGlzdDo6JGJsYWNrbGlzdGVkQ2xhc3NOYW1lc1snU3ltZm9ueUV4Y2x1ZGVMaXN0UGhwdW5pdCddID0gMTsKICAgIFBIUFVuaXRcVXRpbFxCbGFja2xpc3Q6OiRibGFja2xpc3RlZENsYXNzTmFtZXNbJ1N5bWZvbnlFeGNsdWRlTGlzdFNpbXBsZVBocHVuaXQnXSA9IDE7Cn0KClN5bWZvbnlcQnJpZGdlXFBocFVuaXRcVGV4dFVJXENvbW1hbmQ6Om1haW4oKTsKCkVPUEhQCiAgICAgICAgKTsKICAgIH0KCiAgICBjaGRpcignLi4nKTsKICAgIGZpbGVfcHV0X2NvbnRlbnRzKCIuJFBIUFVOSVRfVkVSU0lPTl9ESVIubWQ1IiwgJGNvbmZpZ3VyYXRpb25IYXNoKTsKICAgIGNoZGlyKCRvbGRQd2QpOwp9CgovLyBDcmVhdGUgYSBzeW1saW5rIHdpdGggYSBwcmVkaWN0YWJsZSBwYXRoIHBvaW50aW5nIHRvIHRoZSBjdXJyZW50bHkgdXNlZCB2ZXJzaW9uLgovLyBUaGlzIGlzIHVzZWZ1bCBmb3Igc3RhdGljIGFuYWx5dGljcyB0b29scyBzdWNoIGFzIFBIUFN0YW4gaGF2aW5nIHRvIGxvYWQgUEhQVW5pdCdzIGNsYXNzZXMKLy8gYW5kIGZvciBvdGhlciB0ZXN0aW5nIGxpYnJhcmllcyBzdWNoIGFzIEJlaGF0IHVzaW5nIFBIUFVuaXQncyBhc3NlcnRpb25zLgpjaGRpcigkUEhQVU5JVF9ESVIpOwppZiAoJ1xcJyA9PT0gXERJUkVDVE9SWV9TRVBBUkFUT1IpIHsKICAgIHBhc3N0aHJ1KCdybWRpciAvUyAvUSBwaHB1bml0IDI+IE5VTCcpOwogICAgcGFzc3RocnUoc3ByaW50ZignbWtsaW5rIC9qIHBocHVuaXQgJXMgPiBOVUwgMj4mMScsIGVzY2FwZXNoZWxsYXJnKCRQSFBVTklUX1ZFUlNJT05fRElSKSkpOwp9IGVsc2UgewogICAgaWYgKGZpbGVfZXhpc3RzKCdwaHB1bml0JykpIHsKICAgICAgICBAdW5saW5rKCdwaHB1bml0Jyk7CiAgICB9CiAgICBAc3ltbGluaygkUEhQVU5JVF9WRVJTSU9OX0RJUiwgJ3BocHVuaXQnKTsKfQpjaGRpcigkb2xkUHdkKTsKCmlmICgkUEhQVU5JVF9WRVJTSU9OIDwgOC4wKSB7CiAgICAkYXJndiA9IGFycmF5X2ZpbHRlcigkYXJndiwgZnVuY3Rpb24gKCR2KSB1c2UgKCYkYXJnYykgewogICAgICAgIGlmICgnLS1kby1ub3QtY2FjaGUtcmVzdWx0JyAhPT0gJHYpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIC0tJGFyZ2M7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwp9IGVsc2VpZiAoZmlsdGVyX3ZhcihnZXRlbnYoJ1NZTUZPTllfUEhQVU5JVF9ESVNBQkxFX1JFU1VMVF9DQUNIRScpLCBcRklMVEVSX1ZBTElEQVRFX0JPT0xFQU4pKSB7CiAgICAkYXJndltdID0gJy0tZG8tbm90LWNhY2hlLXJlc3VsdCc7CiAgICArKyRhcmdjOwp9CgokY29tcG9uZW50cyA9IFtdOwokY21kID0gYXJyYXlfbWFwKCdlc2NhcGVzaGVsbGFyZycsICRhcmd2KTsKJGV4aXQgPSAwOwoKaWYgKGlzc2V0KCRhcmd2WzFdKSAmJiAnc3ltZm9ueScgPT09ICRhcmd2WzFdICYmICFmaWxlX2V4aXN0cygnc3ltZm9ueScpICYmIGZpbGVfZXhpc3RzKCdzcmMvU3ltZm9ueScpKSB7CiAgICAkYXJndlsxXSA9ICdzcmMvU3ltZm9ueSc7Cn0KaWYgKGlzc2V0KCRhcmd2WzFdKSAmJiBpc19kaXIoJGFyZ3ZbMV0pICYmICFmaWxlX2V4aXN0cygkYXJndlsxXS4nL3BocHVuaXQueG1sLmRpc3QnKSkgewogICAgLy8gRmluZCBTeW1mb255IGNvbXBvbmVudHMgaW4gcGxhaW4gcGhwIGZvciBXaW5kb3dzIHBvcnRhYmlsaXR5CgogICAgJGZpbmRlciA9IG5ldyBSZWN1cnNpdmVEaXJlY3RvcnlJdGVyYXRvcigkYXJndlsxXSwgRmlsZXN5c3RlbUl0ZXJhdG9yOjpLRVlfQVNfRklMRU5BTUUgfCBGaWxlc3lzdGVtSXRlcmF0b3I6OlVOSVhfUEFUSFMpOwogICAgJGZpbmRlciA9IG5ldyBSZWN1cnNpdmVJdGVyYXRvckl0ZXJhdG9yKCRmaW5kZXIpOwogICAgJGZpbmRlci0+c2V0TWF4RGVwdGgoZ2V0ZW52KCdTWU1GT05ZX1BIUFVOSVRfTUFYX0RFUFRIJykgPzogMyk7CgogICAgZm9yZWFjaCAoJGZpbmRlciBhcyAkZmlsZSA9PiAkZmlsZUluZm8pIHsKICAgICAgICBpZiAoJ3BocHVuaXQueG1sLmRpc3QnID09PSAkZmlsZSkgewogICAgICAgICAgICAkY29tcG9uZW50c1tdID0gZGlybmFtZSgkZmlsZUluZm8tPmdldFBhdGhuYW1lKCkpOwogICAgICAgIH0KICAgIH0KICAgIGlmICgkY29tcG9uZW50cykgewogICAgICAgIGFycmF5X3NoaWZ0KCRjbWQpOwogICAgfQp9CgokY21kWzBdID0gc3ByaW50ZignJXMgJXMgLS1jb2xvcnM9JXMnLCAkUEhQLCBlc2NhcGVzaGVsbGFyZygiJFBIUFVOSVRfRElSLyRQSFBVTklUX1ZFUlNJT05fRElSL3BocHVuaXQiKSwgJycgPT09ICRnZXRFbnZWYXIoJ05PX0NPTE9SJywgJycpID8gJ2Fsd2F5cycgOiAnbmV2ZXInKTsKJGNtZCA9IHN0cl9yZXBsYWNlKCclJywgJyUlJywgaW1wbG9kZSgnICcsICRjbWQpKS4nICUxJHMnOwoKaWYgKCdcXCcgPT09IFxESVJFQ1RPUllfU0VQQVJBVE9SKSB7CiAgICAkY21kID0gJ2NtZCAvdjpvbiAvZCAvYyAiKCcuJGNtZC4nKSUyJHMiJzsKfSBlbHNlIHsKICAgICRjbWQgLj0gJyUyJHMnOwp9CgppZiAoJGNvbXBvbmVudHMpIHsKICAgICRza2lwcGVkVGVzdHMgPSAkX1NFUlZFUlsnU1lNRk9OWV9QSFBVTklUX1NLSVBQRURfVEVTVFMnXSA/PyBmYWxzZTsKICAgICRydW5uaW5nUHJvY3MgPSBbXTsKCiAgICBmb3JlYWNoICgkY29tcG9uZW50cyBhcyAkY29tcG9uZW50KSB7CiAgICAgICAgLy8gUnVuIHBocHVuaXQgdGVzdHMgaW4gcGFyYWxsZWwKCiAgICAgICAgaWYgKCRza2lwcGVkVGVzdHMpIHsKICAgICAgICAgICAgcHV0ZW52KCJTWU1GT05ZX1BIUFVOSVRfU0tJUFBFRF9URVNUUz0kY29tcG9uZW50LyRza2lwcGVkVGVzdHMiKTsKICAgICAgICB9CgogICAgICAgICRjID0gZXNjYXBlc2hlbGxhcmcoJGNvbXBvbmVudCk7CgogICAgICAgIGlmICgkcHJvYyA9IHByb2Nfb3BlbihzcHJpbnRmKCRjbWQsICRjLCAiID4gJGMvcGhwdW5pdC5zdGRvdXQgMj4gJGMvcGhwdW5pdC5zdGRlcnIiKSwgW10sICRwaXBlcykpIHsKICAgICAgICAgICAgJHJ1bm5pbmdQcm9jc1skY29tcG9uZW50XSA9ICRwcm9jOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRleGl0ID0gMTsKICAgICAgICAgICAgZWNobyAiXDAzM1s0MW1LT1wwMzNbMG0gJGNvbXBvbmVudFxuXG4iOwogICAgICAgIH0KICAgIH0KCiAgICAkbGFzdE91dHB1dCA9IG51bGw7CiAgICAkbGFzdE91dHB1dFRpbWUgPSBudWxsOwoKICAgIHdoaWxlICgkcnVubmluZ1Byb2NzKSB7CiAgICAgICAgdXNsZWVwKDMwMDAwMCk7CiAgICAgICAgJHRlcm1pbmF0ZWRQcm9jcyA9IFtdOwogICAgICAgIGZvcmVhY2ggKCRydW5uaW5nUHJvY3MgYXMgJGNvbXBvbmVudCA9PiAkcHJvYykgewogICAgICAgICAgICAkcHJvY1N0YXR1cyA9IHByb2NfZ2V0X3N0YXR1cygkcHJvYyk7CiAgICAgICAgICAgIGlmICghJHByb2NTdGF0dXNbJ3J1bm5pbmcnXSkgewogICAgICAgICAgICAgICAgJHRlcm1pbmF0ZWRQcm9jc1skY29tcG9uZW50XSA9ICRwcm9jU3RhdHVzWydleGl0Y29kZSddOwogICAgICAgICAgICAgICAgdW5zZXQoJHJ1bm5pbmdQcm9jc1skY29tcG9uZW50XSk7CiAgICAgICAgICAgICAgICBwcm9jX2Nsb3NlKCRwcm9jKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCEkdGVybWluYXRlZFByb2NzICYmIDEgPT09IGNvdW50KCRydW5uaW5nUHJvY3MpKSB7CiAgICAgICAgICAgICRjb21wb25lbnQgPSBrZXkoJHJ1bm5pbmdQcm9jcyk7CgogICAgICAgICAgICAkb3V0cHV0ID0gZmlsZV9nZXRfY29udGVudHMoIiRjb21wb25lbnQvcGhwdW5pdC5zdGRvdXQiKTsKICAgICAgICAgICAgJG91dHB1dCAuPSBmaWxlX2dldF9jb250ZW50cygiJGNvbXBvbmVudC9waHB1bml0LnN0ZGVyciIpOwoKICAgICAgICAgICAgaWYgKCRsYXN0T3V0cHV0ICE9PSAkb3V0cHV0KSB7CiAgICAgICAgICAgICAgICAkbGFzdE91dHB1dCA9ICRvdXRwdXQ7CiAgICAgICAgICAgICAgICAkbGFzdE91dHB1dFRpbWUgPSBtaWNyb3RpbWUodHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZWlmIChtaWNyb3RpbWUodHJ1ZSkgLSAkbGFzdE91dHB1dFRpbWUgPiA2MCkgewogICAgICAgICAgICAgICAgZWNobyAiXDAzM1s0MW1UaW1lb3V0XDAzM1swbSAkY29tcG9uZW50XG5cbiI7CgogICAgICAgICAgICAgICAgaWYgKCdcXCcgPT09IFxESVJFQ1RPUllfU0VQQVJBVE9SKSB7CiAgICAgICAgICAgICAgICAgICAgZXhlYyhzcHJpbnRmKCd0YXNra2lsbCAvRiAvVCAvUElEICVkIDI+JjEnLCAkcHJvY1N0YXR1c1sncGlkJ10pLCAkb3V0cHV0LCAkZXhpdENvZGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcm9jX3Rlcm1pbmF0ZShjdXJyZW50KCRydW5uaW5nUHJvY3MpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm9yZWFjaCAoJHRlcm1pbmF0ZWRQcm9jcyBhcyAkY29tcG9uZW50ID0+ICRwcm9jU3RhdHVzKSB7CiAgICAgICAgICAgIGZvcmVhY2ggKFsnb3V0JywgJ2VyciddIGFzICRmaWxlKSB7CiAgICAgICAgICAgICAgICAkZmlsZSA9ICIkY29tcG9uZW50L3BocHVuaXQuc3RkJGZpbGUiOwogICAgICAgICAgICAgICAgcmVhZGZpbGUoJGZpbGUpOwogICAgICAgICAgICAgICAgdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRmFpbCBvbiBhbnkgaW5kaXZpZHVhbCBjb21wb25lbnQgZmFpbHVyZXMgYnV0IGlnbm9yZSBzb21lIGVycm9yIGNvZGVzIG9uIFdpbmRvd3Mgd2hlbiBBUEN1IGlzIGVuYWJsZWQ6CiAgICAgICAgICAgIC8vIFNUQVRVU19TVEFDS19CVUZGRVJfT1ZFUlJVTiAoLTEwNzM3NDA3OTEvMHhDMDAwMDQwOSkKICAgICAgICAgICAgLy8gU1RBVFVTX0FDQ0VTU19WSU9MQVRJT04gKC0xMDczNzQxODE5LzB4QzAwMDAwMDUpCiAgICAgICAgICAgIC8vIFNUQVRVU19IRUFQX0NPUlJVUFRJT04gKC0xMDczNzQwOTQwLzB4QzAwMDAzNzQpCiAgICAgICAgICAgIGlmICgkcHJvY1N0YXR1cyAmJiAoJ1xcJyAhPT0gXERJUkVDVE9SWV9TRVBBUkFUT1IgfHwgIWV4dGVuc2lvbl9sb2FkZWQoJ2FwY3UnKSB8fCAhZmlsdGVyX3ZhcihpbmlfZ2V0KCdhcGMuZW5hYmxlX2NsaScpLCBcRklMVEVSX1ZBTElEQVRFX0JPT0xFQU4pIHx8ICFpbl9hcnJheSgkcHJvY1N0YXR1cywgWy0xMDczNzQwNzkxLCAtMTA3Mzc0MTgxOSwgLTEwNzM3NDA5NDBdKSkpIHsKICAgICAgICAgICAgICAgICRleGl0ID0gJHByb2NTdGF0dXM7CiAgICAgICAgICAgICAgICBlY2hvICJcMDMzWzQxbUtPXDAzM1swbSAkY29tcG9uZW50XG5cbiI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlY2hvICJcMDMzWzMybU9LXDAzM1swbSAkY29tcG9uZW50XG5cbiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0gZWxzZWlmICghaXNzZXQoJGFyZ3ZbMV0pIHx8ICdpbnN0YWxsJyAhPT0gJGFyZ3ZbMV0gfHwgZmlsZV9leGlzdHMoJ2luc3RhbGwnKSkgewogICAgaWYgKCFjbGFzc19leGlzdHMoXFN5bWZvbnlFeGNsdWRlTGlzdFNpbXBsZVBocHVuaXQ6OmNsYXNzLCBmYWxzZSkpIHsKICAgICAgICBjbGFzcyBTeW1mb255RXhjbHVkZUxpc3RTaW1wbGVQaHB1bml0CiAgICAgICAgewogICAgICAgIH0KICAgIH0KICAgIGFycmF5X3NwbGljZSgkYXJndiwgMSwgMCwgWyctLWNvbG9ycz0nLignJyA9PT0gJGdldEVudlZhcignTk9fQ09MT1InLCAnJykgPyAnYWx3YXlzJyA6ICduZXZlcicpXSk7CiAgICAkX1NFUlZFUlsnYXJndiddID0gJGFyZ3Y7CiAgICAkX1NFUlZFUlsnYXJnYyddID0gKyskYXJnYzsKICAgIGluY2x1ZGUgIiRQSFBVTklUX0RJUi8kUEhQVU5JVF9WRVJTSU9OX0RJUi9waHB1bml0IjsKfQoKZXhpdCgkZXhpdCk7CiI7czo0MzoiAHBocERvY3VtZW50b3JcUmVmbGVjdGlvblxQaHBcRmlsZQBkb2NCbG9jayI7TjtzOjQzOiIAcGhwRG9jdW1lbnRvclxSZWZsZWN0aW9uXFBocFxGaWxlAG1ldGFkYXRhIjthOjA6e319";